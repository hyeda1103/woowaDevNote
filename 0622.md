[β† λ’¤λ΅](./README.md)

# λ―Έλ‹ λ¦¬λ•μ¤ λ§λ“¤κΈ°

- μ„Έλ―Έλ‚ μΌμ: 2021-06-22(ν™”)
- λ“±μ¥μΈλ¬Ό
    - μ°μ•„ν• ν•μ λ“¤ κΈ°μ μ΄μ‚¬ κΉ€λ―Όνƒλ‹π‘“
    - μ•„ν” μ•„ν™‰λ…μ κµμ΅μƒλ“¤π–
        - λ‚π¥

## μ°λ¦¬μ λ€ν™”
- μ΄λ‚  λ‚λ” μ†λ¦¬μ—†μ΄ κ°•μλ¥Ό λ“¤μ–΄μ•Ό ν–λ‹¤(κ°μΈμ‚¬μ •μƒ)
    - μμ†κ±°λ΅ λ΄¤μΌλ‹ μμ—…μ‹κ°„μ— κµ¬ν„ν• μ½”λ“ μ΄ν•΄λ” λ‚΄ λ«μ΄λ‹¤
- κ°•μλ¥Ό λ†“μΉκΈ°λ” μ‹«μ–΄μ„ ν•Έλ“ν°μΌλ΅ μ¤μ„ μ¬μ© μΌλ†“κ³  λ…ΈνΈλ¶μ—λ” μ½”λ“μƒλ“λ°•μ¤λ¥Ό μ—΄μ–΄λ†“μ€ μ±„ μ€λ°€ν μ½”λ“λ¥Ό λ”°λΌ μ³¤λ‹¤.
    - π”— [μ½”λ“μƒλ“λ°•μ¤ λ³΄λ¬κ°€κΈ°](https://codesandbox.io/embed/loving-mendel-j3fzm?fontsize=14&hidenavigation=1&theme=light)

### λ―Έλ‹ λ¦¬λ•μ¤ λ§λ“¤κΈ°
- μ΄ λ²„μ „μ λ―Έλ‹ λ¦¬λ•μ¤ `createStore` ν•¨μμ—λ” λ―Έλ“¤μ›¨μ–΄λ„ κµ¬ν„λμ–΄ μλ‹¤

```js
// index.js
function createStore(reducer, middleware = []) {
  let state = {};

  let dispatch = (action) => {
    reducer(action);
  };

  let backupDispatch = dispatch;

  middleware.reverse().forEach((m) => {
    backupDispatch = m(store)(backupDispatch);
  });

  const store = {
    getState: () => {},
    dispatch: backupDispatch
  };

  return store;
}

function reducer(action) {
  console.log(action);
}

const fetchUserInfo = (store) => (next) => (action) => {
  if (action.type === "fetch user info") {
    setTimeout(() => {
      next({
        type: "response user info"
      });
    }, 3000);
  } else {
    next(action);
  }
  console.log("logger B => ", action.type);
};

const store = createStore(reducer, [fetchUserInfo]);

store.dispatch({ type: "fetch posts" });
store.dispatch({ type: "fetch user info" });

/*
{type: "fetch posts"}
logger B =>  fetch posts 
logger B =>  fetch user info 
{type: "response user info"}
*/
```

---

### λ°”λ‹λΌ JSλ΅ λ―Έλ‹ λ¦¬λ•μ¤ κµ¬ν„ν•κ³  μΉ΄μ΄ν„° λ§λ“¤κΈ°
<img src="./images/simpleCounterMadeWithMiniReducer.gif" alt="λ―Έλ‹ λ¦¬λ“€μ„λ΅ κµ¬ν„ν• μΉ΄μ΄ν„°" />

- μ„μ μμ λ§μΌλ΅λ” μ™„μ „ν• μ΄ν•΄κ°€ μ–΄λ ¤μ›μ„ μ•„λ νν† λ¦¬μ–Όμ„ μ°Ύμ•„μ„ λ”°λΌν•΄λ΄¤λ‹¤.
    - π”— [How to Implement Redux in 24 Lines of JavaScript](https://www.freecodecamp.org/news/redux-in-24-lines-of-code/)
- λ‚΄κ°€ μ§μ ‘ λ”°λΌν•΄λ³Έ μ½”λ“λ” μ•„λ λ§ν¬μ—μ„ ν™•μΈν•  μ μλ‹¤. 
    - π”— [μ½”λ“μƒλ“λ°•μ¤ λ³΄λ¬κ°€κΈ°](https://codesandbox.io/embed/distracted-worker-jhovj?fontsize=14&hidenavigation=1&theme=dark)
    - νν† λ¦¬μ–Όκ³Ό λ‹¤λ¥΄κ² νμΌμ„ μΆ€ λ” λ¶„λ¦¬ν–λ‹¤. 
        - μ‹¤μ  `Redux`λ¥Ό κµ¬ν„ν• νμΌμ€ `redux.js`
        - μ•΅μ…κ³Ό λ¦¬λ“€μ„λ” `modules/counter.js`
        - κ·Έλ°–μ— μΉ΄μ΄ν„° μ”μ†μ λ…Έλ“λ¥Ό μ·¨λ“ν•μ—¬ λ™μ μΌλ΅ μ΅°μ‘ν•λ” μ½”λ“λ” `index.js` νμΌμ— μλ‹¤.     


```js
// redux.js
const createStore = (reducer) => {
  let listeners = [];
  let currentState = reducer(undefined, {});

  return {
    // getStateν•¨μλ” ν„μ¬ μƒνƒλ¥Ό λ°ν™
    getState: () => currentState,
    /* dispatchλ” μ•΅μ…μ„ λ°μƒμ‹ν‚¤λ” ν•¨μ
    dispatch(action)κ³Ό κ°™μ€ ν•νƒλ΅ μ•΅μ… κ°μ²΄λ¥Ό νλΌλ―Έν„°λ΅ λ„£μ–΄μ„ νΈμ¶ */
    dispatch: (action) => {
      // λ¦¬λ“€μ„ ν•¨μλ¥Ό μ‹¤ν–‰ν•μ—¬ μƒλ΅μ΄ μƒνƒ μƒμ„±
      currentState = reducer(currentState, action);
      listeners.forEach((listener) => {
        listener();
      });
    },
    /* subscirbe ν•¨μμ— λ¦¬μ¤λ„ ν•¨μλ¥Ό νλΌλ―Έν„°λ΅ λ„£μ–΄μ„ νΈμ¶ν•λ©΄ 
    dispatch ν•¨μκ°€ νΈμ¶λμ–΄ μƒνƒκ°€ μ—…λ°μ΄νΈλ  λ•λ§λ‹¤ 
    λ¦¬μ¤λ„ ν•¨μ νΈμ¶ */
    subscribe: (newListener) => {
      listeners.push(newListener);
      /* unsubscribeλ” νλΌλ―Έν„°λ΅ λ°›μ€ λ¦¬μ¤λ„ ν•¨μκ°€
      dispatch ν•¨μκ°€ νΈμ¶λμ–΄ μƒνƒκ°€ μ—…λ°μ΄νΈλ  λ•λ§λ‹¤
      νΈμ¶λλ” κ²ƒμ„ λΉ„ν™μ„±ν™”ν•λ” ν•¨μ */
      const unsubscribe = () => {
        listeners = listeners.filter((el) => el !== newListener);
      };

      return unsubscribe;
    }
  };
};

export { createStore };
```

```js
// modules/counter.js

import { createStore } from "../redux.js";

const initialState = { count: 0 };

/* μ•΅μ…(Action)μ€ μƒνƒ λ³€ν™”κ°€ ν•„μ”ν•  λ• λ°μƒ
μ•΅μ… κ°μ²΄λ” λ°λ“μ‹ type ν•„λ“λ¥Ό κ°€μ§€κ³  μμ–΄μ•Ό ν•¨ */
const actions = {
  increment: { type: "INCREMENT" },
  decrement: { type: "DECREMENT" }
};

/* λ¦¬λ“€μ„(Reducer)λ” λ³€ν™”λ¥Ό μΌμΌν‚¤λ” ν•¨μ
λ¦¬λ“€μ„λ” μ²«λ²μ§Έ νλΌλ―Έν„°λ΅ ν„μ¬ μƒνƒ, λ‘λ²μ§Έ νλΌλ―Έν„°λ΅ μ•΅μ… κ°μ²΄λ¥Ό λ°›μ
λ‘ κ°’μ„ μ°Έκ³ ν•μ—¬ μƒλ΅μ΄ μƒνƒλ¥Ό λ§λ“¤μ–΄μ„ λ°ν™ */
const countReducer = (state = initialState, action) => {
  switch (action.type) {
    case actions.increment.type:
      return {
        count: state.count + 1
      };
    case actions.decrement.type:
      return {
        count: state.count - 1
      };
    default:
      return state;
  }
};

// μ¤ν† μ–΄ μ•μ—λ” ν„μ¬ μƒνƒμ™€ λ¦¬λ“€μ„κ°€ λ“¤μ–΄μμ
const store = createStore(countReducer);

export { store, actions, initialState };
```

```js
// index.js
import { store, actions, initialState } from "./modules/counter";

// DOM μ„ νƒμ
const incrementButton = document.querySelector(".increment");
const decrementButton = document.querySelector(".decrement");

// μ΄λ²¤νΈ ν•Έλ“¤λ¬ λ“±λ΅
incrementButton.addEventListener("click", () => {
  store.dispatch(actions.increment);
});

decrementButton.addEventListener("click", () => {
  store.dispatch(actions.decrement);
});

const counterDisplay = document.querySelector("h1");
counterDisplay.innerHTML = parseInt(initialState.count);

store.subscribe(() => {
  const state = store.getState();

  counterDisplay.innerHTML = parseInt(state.count);
});
```

## λ‚μ μƒκ°
- λ¦¬λ•μ¤μ μ‹¤μ²΄λ” λ°”λ‹λΌ JSλ΅ μ±„ μ„λ¥Έ μ¤„λ„ λμ§€ μ•λ” κ²ƒμ΄μ—λ‹¤
  - ν•μ§€λ§ μ§€μΌμ•Ό ν•  `convention`μ΄ λ§μ•„μ„ κΉλ‹¤λ΅­κ² λκ»΄μ§€κ³  λ¬λ‹ μ»¤λΈκ°€ μλ‹¤: 
    - `Redux` = 90% `convention` + 10% `redux`
- λ°”λ‹λΌ JSλ΅ λ―Έλ‹ λ¦¬λ•μ¤λ¥Ό κµ¬ν„ν•΄λ³Έλ‹¤κΈΈλ κΈ°λ€λ„ λκ³  κ²λ„ λ‚¬λ”λ°, μ΄ κ³Όμ •μ„ ν•΄λ³΄κ³  λ‚λ‹ λ¦¬λ•μ¤κ°€ μ¤νλ ¤ λ” μ‰½κ² λκ»΄μ΅λ‹¤
  - `redux` λ―Έλ“¤μ›¨μ–΄λ¥Ό μΆ€ λ” μ΄ν•΄ν•κ³  μ‹¶λ‹¤
  - κ³µλ¶€ν•  κ² λ¬΄μ§€ λ§λ‹¤
