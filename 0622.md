[â† ë’¤ë¡œ](./README.md)

# ë¯¸ë‹ˆ ë¦¬ë•ìŠ¤ ë§Œë“¤ê¸°

- ì„¸ë¯¸ë‚˜ ì¼ì: 2021-06-22(í™”)
- ë“±ì¥ì¸ë¬¼
    - ìš°ì•„í•œ í˜•ì œë“¤ ê¸°ìˆ ì´ì‚¬ ê¹€ë¯¼íƒœë‹˜ğŸ‘“
    - ì•„í” ì•„í™‰ëª…ì˜ êµìœ¡ìƒë“¤ğŸ–
        - ë‚˜ğŸ¥

## ìš°ë¦¬ì˜ ëŒ€í™”
- ì´ë‚  ë‚˜ëŠ” ì†Œë¦¬ì—†ì´ ê°•ì˜ë¥¼ ë“¤ì–´ì•¼ í–ˆë‹¤(ê°œì¸ì‚¬ì •ìƒ)
    - ìŒì†Œê±°ë¡œ ë´¤ìœ¼ë‹ˆ ìˆ˜ì—…ì‹œê°„ì— êµ¬í˜„í•œ ì½”ë“œ ì´í•´ëŠ” ë‚´ ëª«ì´ë‹¤
- ê°•ì˜ë¥¼ ë†“ì¹˜ê¸°ëŠ” ì‹«ì–´ì„œ í•¸ë“œí°ìœ¼ë¡œ ì¤Œì„ ìŠ¬ì© ì¼œë†“ê³  ë…¸íŠ¸ë¶ì—ëŠ” ì½”ë“œìƒŒë“œë°•ìŠ¤ë¥¼ ì—´ì–´ë†“ì€ ì±„ ì€ë°€íˆ ì½”ë“œë¥¼ ë”°ë¼ ì³¤ë‹¤.
    - ğŸ”— [ì½”ë“œìƒŒë“œë°•ìŠ¤ ë³´ëŸ¬ê°€ê¸°](https://codesandbox.io/embed/loving-mendel-j3fzm?fontsize=14&hidenavigation=1&theme=light)

### ë¯¸ë‹ˆ ë¦¬ë•ìŠ¤ ë§Œë“¤ê¸°

```js
// index.js
function createStore(reducer, middleware = []) {
  let state = {};

  let dispatch = (action) => {
    reducer(action);
  };

  let backupDispatch = dispatch;

  middleware.reverse().forEach((m) => {
    backupDispatch = m(store)(backupDispatch);
  });

  const store = {
    getState: () => {},
    dispatch: backupDispatch
  };

  return store;
}

function reducer(action) {
  console.log(action);
}

const fetchUserInfo = (store) => (next) => (action) => {
  if (action.type === "fetch user info") {
    setTimeout(() => {
      next({
        type: "response user info"
      });
    }, 3000);
  } else {
    next(action);
  }
  console.log("logger B => ", action.type);
};

const store = createStore(reducer, [fetchUserInfo]);

store.dispatch({ type: "fetch posts" });
store.dispatch({ type: "fetch user info" });

/*
{type: "fetch posts"}
logger B =>  fetch posts 
logger B =>  fetch user info 
{type: "response user info"}
*/
```

---

### ë°”ë‹ë¼ JSë¡œ ë¯¸ë‹ˆ ë¦¬ë•ìŠ¤ êµ¬í˜„í•˜ê³  ì¹´ìš´í„° ë§Œë“¤ê¸°
- ìœ„ì˜ ì˜ˆì œë§Œìœ¼ë¡œëŠ” ì™„ì „í•œ ì´í•´ê°€ ì–´ë ¤ì›Œì„œ 'ë°”ë‹ë¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬í˜„í•œ ë¯¸ë‹ˆ ë¦¬ë“€ì„œë¡œ ê°„ë‹¨í•œ ì¹´ìš´í„°'ë¥¼ êµ¬í˜„í•˜ëŠ” íŠœí† ë¦¬ì–¼ì„ ì°¾ì•„ì„œ ë”°ë¼í•´ë´¤ë‹¤.
    - ğŸ”— [How to Implement Redux in 24 Lines of JavaScript](https://www.freecodecamp.org/news/redux-in-24-lines-of-code/)
- ë‚´ê°€ ì§ì ‘ ë”°ë¼í•´ë³¸ ì½”ë“œëŠ” ì•„ë˜ ë§í¬ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 
    - ğŸ”— [ì½”ë“œìƒŒë“œë°•ìŠ¤ ë³´ëŸ¬ê°€ê¸°](https://codesandbox.io/embed/distracted-worker-jhovj?fontsize=14&hidenavigation=1&theme=dark)
    <img src="./images/simpleCounterMadeWithMiniReducer.gif" alt="ë¯¸ë‹ˆ ë¦¬ë“€ì„œë¡œ êµ¬í˜„í•œ ì¹´ìš´í„°" />
    - íŠœí† ë¦¬ì–¼ê³¼ ë‹¤ë¥´ê²Œ íŒŒì¼ì„ ì¢€ ë” ë¶„ë¦¬í–ˆë‹¤. 
        - ì‹¤ì œ `Redux`ë¥¼ êµ¬í˜„í•œ íŒŒì¼ì€ `redux.js`
        - ì•¡ì…˜ê³¼ ë¦¬ë“€ì„œëŠ” `modules/counter.js`
        - ê·¸ë°–ì— ì¹´ìš´í„° ìš”ì†Œì˜ ë…¸ë“œë¥¼ ì·¨ë“í•˜ì—¬ ë™ì ìœ¼ë¡œ ì¡°ì‘í•˜ëŠ” ì½”ë“œëŠ” `index.js` íŒŒì¼ì— ìˆë‹¤.     


```js
// redux.js
const createStore = (reducer) => {
  let listeners = [];
  let currentState = reducer(undefined, {});

  return {
    // getStateí•¨ìˆ˜ëŠ” í˜„ì¬ ìƒíƒœë¥¼ ë°˜í™˜
    getState: () => currentState,
    /* dispatchëŠ” ì•¡ì…˜ì„ ë°œìƒì‹œí‚¤ëŠ” í•¨ìˆ˜
    dispatch(action)ê³¼ ê°™ì€ í˜•íƒœë¡œ ì•¡ì…˜ ê°ì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„£ì–´ì„œ í˜¸ì¶œ */
    dispatch: (action) => {
      // ë¦¬ë“€ì„œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ ìƒíƒœ ìƒì„±
      currentState = reducer(currentState, action);
      listeners.forEach((listener) => {
        listener();
      });
    },
    /* subscirbe í•¨ìˆ˜ì— ë¦¬ìŠ¤ë„ˆ í•¨ìˆ˜ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë„£ì–´ì„œ í˜¸ì¶œí•˜ë©´ 
    dispatch í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤ 
    ë¦¬ìŠ¤ë„ˆ í•¨ìˆ˜ í˜¸ì¶œ */
    subscribe: (newListener) => {
      listeners.push(newListener);
      /* unsubscribeëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ ë¦¬ìŠ¤ë„ˆ í•¨ìˆ˜ê°€
      dispatch í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤
      í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë¹„í™œì„±í™”í•˜ëŠ” í•¨ìˆ˜ */
      const unsubscribe = () => {
        listeners = listeners.filter((el) => el !== newListener);
      };

      return unsubscribe;
    }
  };
};

export { createStore };
```

```js
// modules/counter.js

import { createStore } from "../redux.js";

const initialState = { count: 0 };

/* ì•¡ì…˜(Action)ì€ ìƒíƒœ ë³€í™”ê°€ í•„ìš”í•  ë•Œ ë°œìƒ
ì•¡ì…˜ ê°ì²´ëŠ” ë°˜ë“œì‹œ type í•„ë“œë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í•¨ */
const actions = {
  increment: { type: "INCREMENT" },
  decrement: { type: "DECREMENT" }
};

/* ë¦¬ë“€ì„œ(Reducer)ëŠ” ë³€í™”ë¥¼ ì¼ìœ¼í‚¤ëŠ” í•¨ìˆ˜
ë¦¬ë“€ì„œëŠ” ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ í˜„ì¬ ìƒíƒœ, ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ì•¡ì…˜ ê°ì²´ë¥¼ ë°›ìŒ
ë‘ ê°’ì„ ì°¸ê³ í•˜ì—¬ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜ */
const countReducer = (state = initialState, action) => {
  switch (action.type) {
    case actions.increment.type:
      return {
        count: state.count + 1
      };
    case actions.decrement.type:
      return {
        count: state.count - 1
      };
    default:
      return state;
  }
};

// ìŠ¤í† ì–´ ì•ˆì—ëŠ” í˜„ì¬ ìƒíƒœì™€ ë¦¬ë“€ì„œê°€ ë“¤ì–´ìˆìŒ
const store = createStore(countReducer);

export { store, actions, initialState };
```

```js
// index.js
import { store, actions, initialState } from "./modules/counter";

// DOM ì„ íƒì
const incrementButton = document.querySelector(".increment");
const decrementButton = document.querySelector(".decrement");

// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
incrementButton.addEventListener("click", () => {
  store.dispatch(actions.increment);
});

decrementButton.addEventListener("click", () => {
  store.dispatch(actions.decrement);
});

const counterDisplay = document.querySelector("h1");
counterDisplay.innerHTML = parseInt(initialState.count);

store.subscribe(() => {
  const state = store.getState();

  counterDisplay.innerHTML = parseInt(state.count);
});
```
